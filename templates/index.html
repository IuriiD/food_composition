{% extends "layout.html" %}
{% from '_formhelpers.html' import render_field %}

{% block title %}
    Food Contents - Determine fats, carbohydrates and protein percentage content in food by image
{% endblock %}

{% block body %}

    <img src="{{ image }}" class="img-fluid rounded" style="max-height: 460px, padding-bottom: 10px" name="uploaded_image">

    {% if nutrients_percentage|length>0 %}
        <p style="padding-top: 5pt">
            <button class="btn btn-info" type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
            What's on the image
            </button>
        </p>
        <div class="collapse" id="collapseExample">
            <div class="card card-body">
                {% for label in labels %}
                    <h1 class="display-4">{{ label }}</h1>
                {% endfor %}

                <span class="lead">
                    <strong>
                        Incorrect labels? Please provide a better variant:
                    </strong>
                </span>

                <form role="form" action="/" method="POST" enctype="multipart/form-data">
                    <dl>
                        {{ customlabelform.csrf_token }}
                        {{ render_field(customlabelform.customlabel) }}
                        {{ customlabelform.labelsubmit(class_="btn btn-primary") }}
                    </dl>
                </form>
                <br>
            </div>
        </div>

        <!-- Plot.ly chart -->
        {% for id in ids %}
            <div id="{{id}}"></div>
        {% endfor %}

        <!-- For some reason charts fail to draw when uploading plotly js and/or the following script via layout.html template file-->
        <!-- jQuery first, then Popper.js, then Bootstrap JS -->
          <!-- D3.js -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
          <!-- jQuery -->
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <!-- Plotly.js -->
        <script src="https://d14fo0winaifog.cloudfront.net/plotly-basic.js"></script>
        <script type="text/javascript">
            var graphs = {{graphJSON | safe}};
            var ids = {{ids | safe}};
            for(var i in graphs) {
                Plotly.plot(ids[i], // the ID of the div, created above
                            graphs[i].data,
                            graphs[i].layout || {});
            }
        </script>
        <!-- Plot.ly chart END -->
    {% endif %}

    <form role="form" action="/" method="POST" enctype="multipart/form-data">
        <dl>
            {{ imageuploadform.csrf_token }}
            {{ render_field(imageuploadform.image_file) }}
            or paste image URL
            {{ render_field(imageuploadform.image_link) }}
            {{ imageuploadform.imagesubmit(class_="btn btn-primary") }}
        </dl>
    </form>

{% endblock %}